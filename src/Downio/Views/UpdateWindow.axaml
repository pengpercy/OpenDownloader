<views:DialogWindow xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="using:Downio.Views"
        xmlns:controls="using:Downio.Controls"
        xmlns:services="using:Downio.Services"
        xmlns:md="clr-namespace:LiveMarkdown.Avalonia;assembly=LiveMarkdown.Avalonia"
        mc:Ignorable="d" d:DesignWidth="640" d:DesignHeight="520"
        x:Class="Downio.Views.UpdateWindow"
        x:DataType="views:UpdateViewModel"
        Classes="dialog"
        Title="{Binding WindowTitle}"
        Width="640"
        Height="520"
        SizeToContent="Manual"
        >

    <Design.DataContext>
        <views:UpdateViewModel>
            <views:UpdateViewModel.Release>
                <services:ReleaseInfo TagName="v1.1.0" Body="ðŸš€ ç‰ˆæœ¬å‘å¸ƒ v1.0.32&#x0a;&#x0a;ðŸ› ä¿®å¤ï¼š&#x0a;- ðŸªŸ Windows CI æž„å»ºå¤±è´¥ï¼šä¿®æ­£ CommunityToolkit.WinUI.Notifications çš„ NuGet ç‰ˆæœ¬å·ï¼Œç¡®ä¿ Windows ARM64 ç­‰å¹³å°å¯æ­£å¸¸è¿˜åŽŸä¸Žæž„å»ºã€‚&#x0a;&#x0a;âœ¨ ä¿æŒï¼š&#x0a;- å…¶ä»–åŠŸèƒ½ä¸Žç•Œé¢æ”¹åŠ¨ä¸Ž v1.0.31 ä¸€è‡´ã€‚" />
            </views:UpdateViewModel.Release>
            <views:UpdateViewModel.CurrentVersion>1.0.35</views:UpdateViewModel.CurrentVersion>
        </views:UpdateViewModel>
    </Design.DataContext>

    <controls:DialogHost Title="{Binding $parent[Window].Title}">
        <Grid RowDefinitions="Auto, *, Auto" Margin="4">
            <!-- Header: App Icon and Title -->
            <Grid Grid.Row="0" ColumnDefinitions="Auto, *" Margin="0,0,0,16" IsVisible="{Binding !IsDownloading}">
                <Image Grid.Column="0" Source="/Assets/app_ico.ico" Width="48" Height="48" VerticalAlignment="Top" Margin="0,0,16,0"/>
                <StackPanel Grid.Column="1" Spacing="4">
                    <TextBlock Text="{Binding UpdateTitleText}" FontWeight="Bold" FontSize="16"/>
                    <TextBlock Text="{Binding UpdateDescriptionText}" FontSize="13" TextWrapping="Wrap" Opacity="0.8"/>
                </StackPanel>
            </Grid>

            <!-- Release Notes -->
            <Border Grid.Row="1" 
                    Background="{DynamicResource SystemControlBackgroundBaseLowBrush}" 
                    CornerRadius="4" 
                    Padding="12"
                    IsVisible="{Binding !IsDownloading}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <md:MarkdownRenderer MarkdownBuilder="{Binding ReleaseNotesBuilder}" />
                </ScrollViewer>
            </Border>

            <!-- Progress & Install Status -->
            <StackPanel Grid.Row="1" IsVisible="{Binding IsDownloading}" VerticalAlignment="Center" Margin="0,0,0,20">
                <TextBlock Text="{Binding StatusText}" HorizontalAlignment="Center" Margin="0,0,0,10"
                           FontWeight="SemiBold" IsVisible="{Binding !IsReadyToInstall}"/>
                <ProgressBar Value="{Binding DownloadProgress}" Maximum="1.0" Height="6" CornerRadius="3"
                             IsVisible="{Binding !IsReadyToInstall}"/>
                <TextBlock Text="{Binding DownloadProgress, StringFormat={}{0:P0}}" HorizontalAlignment="Right" FontSize="12" Opacity="0.6" Margin="0,4,0,0"
                           IsVisible="{Binding !IsReadyToInstall}"/>

                <!-- Ready to Install Message -->
                <TextBlock Text="{Binding StatusText}" HorizontalAlignment="Center" FontSize="16" FontWeight="SemiBold"
                           IsVisible="{Binding IsReadyToInstall}" TextAlignment="Center"/>
            </StackPanel>

            <!-- Footer: Checkbox and Buttons -->
            <StackPanel Grid.Row="2" Spacing="16" Margin="0,16,0,0" IsVisible="{Binding !IsDownloading}">
                <!-- Checkbox line -->
                <CheckBox IsChecked="{Binding AutoInstallUpdates}" VerticalAlignment="Center">
                    <TextBlock Text="{Binding AutoUpdateLabelText}" FontSize="12" Opacity="0.8" TextWrapping="Wrap"/>
                </CheckBox>
                
                <!-- Buttons line -->
                <Grid ColumnDefinitions="Auto, *, Auto">
                    <Button Grid.Column="0" Classes="dialogButton" Content="{Binding ButtonSkipText}" Command="{Binding SkipThisVersionCommand}" Click="OnLaterClick"/>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                        <Button Classes="dialogButton" Content="{Binding ButtonLaterText}" Command="{Binding RemindMeLaterCommand}" Click="OnLaterClick"/>
                        <Button Classes="dialogButton accent" Content="{Binding ButtonInstallText}" Click="OnUpdateClick" IsDefault="True"/>
                    </StackPanel>
                </Grid>
            </StackPanel>

            <!-- Buttons: Ready to Install State -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" IsVisible="{Binding IsReadyToInstall}">
                <Button Classes="dialogButton" Content="{Binding ButtonLaterText}" Click="OnLaterClick" IsCancel="True"/>
                <Button Content="{Binding ButtonInstallRelaunchText}" Click="OnInstallClick" IsDefault="True"
                        Classes="dialogButton accent"/>
            </StackPanel>
        </Grid>
    </controls:DialogHost>
</views:DialogWindow>
