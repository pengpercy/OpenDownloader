<views:DialogWindow xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="using:OpenDownloader.Views"
        xmlns:controls="using:OpenDownloader.Controls"
        xmlns:services="using:OpenDownloader.Services"
        xmlns:md="clr-namespace:LiveMarkdown.Avalonia;assembly=LiveMarkdown.Avalonia"
        mc:Ignorable="d" d:DesignWidth="640" d:DesignHeight="520"
        x:Class="OpenDownloader.Views.UpdateWindow"
        x:DataType="views:UpdateViewModel"
        Classes="dialog"
        Title="{Binding WindowTitle}"
        Width="640"
        Height="520"
        SizeToContent="Manual"
        >

    <Design.DataContext>
        <views:UpdateViewModel>
            <views:UpdateViewModel.Release>
                <services:ReleaseInfo TagName="v1.0.31" Body="ðŸš€ ç‰ˆæœ¬å‘å¸ƒ v1.0.31&#x0a;&#x0a;âœ¨ æ”¹è¿›ï¼š&#x0a;- ðŸŽ¨ ä¸»çª—å£æ ‡é¢˜æ ä¸Žå†…å®¹åŒºèƒŒæ™¯åšäº†è½»å¾®åŒºåˆ†ï¼Œæ›´æœ‰å±‚æ¬¡æ„Ÿã€‚&#x0a;- ðŸŽ¯ å·¦ä¸‹è§’è®¾ç½®æ‚¬æµ®èœå•ï¼šhover èƒŒæ™¯ç¨³å®šä½¿ç”¨ä¸»é¢˜å¼ºè°ƒè‰²ï¼ˆè·Ÿéšç³»ç»Ÿä¸»é¢˜ä¹Ÿç”Ÿæ•ˆï¼‰ã€‚&#x0a;- ðŸ“ æ›´æ–°çª—å£å‘å¸ƒè¯´æ˜Žæ”¯æŒ Markdown æ¸²æŸ“ï¼ˆæ›´é€‚åˆé•¿æ–‡ä¸Žåˆ—è¡¨ï¼‰ã€‚&#x0a;&#x0a;ðŸ§¹ å·¥ç¨‹æ¸…ç†ï¼š&#x0a;- ç§»é™¤äº†å†—ä½™çš„ Markdown æ¸²æŸ“åº“ä¾èµ–ï¼Œç»Ÿä¸€ä½¿ç”¨ LiveMarkdown.Avaloniaã€‚" />
            </views:UpdateViewModel.Release>
            <views:UpdateViewModel.CurrentVersion>1.0.30</views:UpdateViewModel.CurrentVersion>
        </views:UpdateViewModel>
    </Design.DataContext>

    <controls:DialogHost Title="{Binding $parent[Window].Title}">
        <Grid RowDefinitions="Auto, *, Auto" Margin="4">
            <!-- Header: App Icon and Title -->
            <Grid Grid.Row="0" ColumnDefinitions="Auto, *" Margin="0,0,0,16" IsVisible="{Binding !IsDownloading}">
                <Image Grid.Column="0" Source="/Assets/app_ico.ico" Width="48" Height="48" VerticalAlignment="Top" Margin="0,0,16,0"/>
                <StackPanel Grid.Column="1" Spacing="4">
                    <TextBlock Text="{Binding UpdateTitleText}" FontWeight="Bold" FontSize="16"/>
                    <TextBlock Text="{Binding UpdateDescriptionText}" FontSize="13" TextWrapping="Wrap" Opacity="0.8"/>
                </StackPanel>
            </Grid>

            <!-- Release Notes -->
            <Border Grid.Row="1" 
                    Background="{DynamicResource SystemControlBackgroundBaseLowBrush}" 
                    CornerRadius="4" 
                    Padding="12"
                    IsVisible="{Binding !IsDownloading}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <md:MarkdownRenderer MarkdownBuilder="{Binding ReleaseNotesBuilder}" />
                </ScrollViewer>
            </Border>

            <!-- Progress & Install Status -->
            <StackPanel Grid.Row="1" IsVisible="{Binding IsDownloading}" VerticalAlignment="Center" Margin="0,0,0,20">
                <TextBlock Text="{Binding StatusText}" HorizontalAlignment="Center" Margin="0,0,0,10"
                           FontWeight="SemiBold" IsVisible="{Binding !IsReadyToInstall}"/>
                <ProgressBar Value="{Binding DownloadProgress}" Maximum="1.0" Height="6" CornerRadius="3"
                             IsVisible="{Binding !IsReadyToInstall}"/>
                <TextBlock Text="{Binding DownloadProgress, StringFormat={}{0:P0}}" HorizontalAlignment="Right" FontSize="12" Opacity="0.6" Margin="0,4,0,0"
                           IsVisible="{Binding !IsReadyToInstall}"/>

                <!-- Ready to Install Message -->
                <TextBlock Text="{Binding StatusText}" HorizontalAlignment="Center" FontSize="16" FontWeight="SemiBold"
                           IsVisible="{Binding IsReadyToInstall}" TextAlignment="Center"/>
            </StackPanel>

            <!-- Footer: Checkbox and Buttons -->
            <StackPanel Grid.Row="2" Spacing="16" Margin="0,16,0,0" IsVisible="{Binding !IsDownloading}">
                <!-- Checkbox line -->
                <CheckBox IsChecked="{Binding AutoInstallUpdates}" VerticalAlignment="Center">
                    <TextBlock Text="{Binding AutoUpdateLabelText}" FontSize="12" Opacity="0.8" TextWrapping="Wrap"/>
                </CheckBox>
                
                <!-- Buttons line -->
                <Grid ColumnDefinitions="Auto, *, Auto">
                    <Button Grid.Column="0" Classes="dialogButton" Content="{Binding ButtonSkipText}" Command="{Binding SkipThisVersionCommand}" Click="OnLaterClick"/>
                    
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                        <Button Classes="dialogButton" Content="{Binding ButtonLaterText}" Command="{Binding RemindMeLaterCommand}" Click="OnLaterClick"/>
                        <Button Classes="dialogButton accent" Content="{Binding ButtonInstallText}" Click="OnUpdateClick" IsDefault="True"/>
                    </StackPanel>
                </Grid>
            </StackPanel>

            <!-- Buttons: Ready to Install State -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" IsVisible="{Binding IsReadyToInstall}">
                <Button Classes="dialogButton" Content="{Binding ButtonLaterText}" Click="OnLaterClick" IsCancel="True"/>
                <Button Content="{Binding ButtonInstallRelaunchText}" Click="OnInstallClick" IsDefault="True"
                        Classes="dialogButton accent"/>
            </StackPanel>
        </Grid>
    </controls:DialogHost>
</views:DialogWindow>
