<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="using:OpenDownloader.Views"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="350"
        x:Class="OpenDownloader.Views.UpdateWindow"
        x:DataType="views:UpdateViewModel"
        Classes="dialog"
        Title="{DynamicResource TitleUpdateAvailable}"
        Width="640"
        Height="520"
        >

    <Border Classes="dialogRoot">
        <Grid RowDefinitions="Auto, *, Auto" Margin="24">
            <!-- Header -->
            <StackPanel Grid.Row="0" Spacing="10" Margin="0,0,0,20">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <PathIcon Data="{StaticResource IconRefresh}" Width="24" Height="24" 
                              Foreground="{DynamicResource SystemAccentColorBrush}" />
                    <TextBlock Text="{DynamicResource TitleUpdateAvailable}" FontWeight="SemiBold" FontSize="20" VerticalAlignment="Center"/>
                </StackPanel>
                <TextBlock Text="{Binding UpdateFromToText}" FontSize="14" Opacity="0.7" Margin="36,0,0,0"
                           IsVisible="{Binding !IsDownloading}"/>
            </StackPanel>

            <!-- Release Notes -->
            <ScrollViewer Grid.Row="1"
                          Margin="-24,0,-24,20"
                          Padding="24,0,24,0"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          IsVisible="{Binding !IsDownloading}">
                <TextBlock Text="{Binding ReleaseNotes}" TextWrapping="Wrap" FontSize="13" Opacity="0.8" LineHeight="20"/>
            </ScrollViewer>

            <!-- Progress & Install Status -->
            <StackPanel Grid.Row="1" IsVisible="{Binding IsDownloading}" VerticalAlignment="Center" Margin="0,0,0,20">
                <TextBlock Text="{Binding StatusText}" HorizontalAlignment="Center" Margin="0,0,0,10"
                           FontWeight="SemiBold" IsVisible="{Binding !IsReadyToInstall}"/>
                <ProgressBar Value="{Binding DownloadProgress}" Maximum="1.0" Height="6" CornerRadius="3"
                             IsVisible="{Binding !IsReadyToInstall}"/>
                <TextBlock Text="{Binding DownloadProgress, StringFormat={}{0:P0}}" HorizontalAlignment="Right" FontSize="12" Opacity="0.6" Margin="0,4,0,0"
                           IsVisible="{Binding !IsReadyToInstall}"/>

                <!-- Ready to Install Message -->
                <TextBlock Text="{Binding StatusText}" HorizontalAlignment="Center" FontSize="16" FontWeight="SemiBold"
                           IsVisible="{Binding IsReadyToInstall}" TextAlignment="Center"/>
            </StackPanel>

            <!-- Buttons: Initial State -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" IsVisible="{Binding !IsDownloading}">
                <Button Classes="dialogButton" Content="{DynamicResource ButtonLater}" Click="OnLaterClick" IsCancel="True"/>
                <Button Content="{DynamicResource ButtonUpdateNow}" Click="OnUpdateClick" IsDefault="True"
                        Classes="dialogButton accent"/>
            </StackPanel>

            <!-- Buttons: Ready to Install State -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="12" IsVisible="{Binding IsReadyToInstall}">
                <Button Classes="dialogButton" Content="{DynamicResource ButtonLater}" Click="OnLaterClick" IsCancel="True"/>
                <Button Content="{DynamicResource ButtonInstallAndRelaunch}" Click="OnInstallClick" IsDefault="True"
                        Classes="dialogButton accent"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>
